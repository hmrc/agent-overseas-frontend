@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.agentoverseasfrontend.controllers.application.routes
@import uk.gov.hmrc.agentoverseasfrontend.models._
@import uk.gov.hmrc.agentoverseasfrontend.views.html._
@import uk.gov.hmrc.agentoverseasfrontend.config.AppConfig
@import uk.gov.hmrc.govukfrontend.views.viewmodels.errorsummary.ErrorSummary
@import uk.gov.hmrc.govukfrontend.views.html.components._
@import uk.gov.hmrc.hmrcfrontend.views.Implicits.RichErrorSummary
@import uk.gov.hmrc.govukfrontend.views.Implicits.RichInput
@import uk.gov.hmrc.agentoverseasfrontend.views.html.components._

@this(
    mainTemplate: main_template,
    errorPrefix: error_prefix,
    govukErrorSummary: GovukErrorSummary,
    submitButton: submitButton, p: p,
    govukCheckboxes: GovukCheckboxes,
    govukInput: GovukInput,
    formWithCsrf: FormWithCSRF
)

@(agentCodesForm: Form[AgentCodes], backLink: Option[String] = None)(implicit msgs: Messages, request: RequestHeader, appConfig: AppConfig)

@saValue = @{ agentCodesForm("self-assessment").value.getOrElse("") }
@ctValue = @{ agentCodesForm("corporation-tax").value.getOrElse("") }

@mainTemplate(
    title = errorPrefix(agentCodesForm) + msgs("agentCodes.title"),
    backLinkHref = Some(backLink.getOrElse(routes.ApplicationController.showRegisteredWithHmrcForm.url))
) {

    @if(agentCodesForm.hasErrors) {
        @govukErrorSummary(ErrorSummary().withFormErrorsAsText(agentCodesForm))
    }

    <h1 class="govuk-heading-xl">
        <span class="govuk-caption-xl">@msgs("agentCodes.caption")</span>
        @msgs("agentCodes.title")
    </h1>

    @p("agentCodes.p1")
    @p("agentCodes.form.hint")

    @formWithCsrf(action = routes.ApplicationController.submitAgentCodes) {
        @govukCheckboxes(Checkboxes(
            fieldset = Some(Fieldset(
                legend = Some(Legend(
                    content = Text(msgs("agentCodes.title")),
                    classes = "govuk-visually-hidden"
                ))
            )),
            name = "agentCodes",
            items = Seq(
                CheckboxItem(
                    id = Some("self-assessment-checkbox"),
                    name = Some("self-assessment-checkbox"),
                    content = Text(msgs("agentCodes.form.self-assessment.label")),
                    value = "true",
                    checked = saValue.nonEmpty || agentCodesForm.error("self-assessment").isDefined,
                    conditionalHtml = Some(
                        govukInput(Input(
                            label = Label(
                                content = Text( msgs("agentCodes.form.self-assessment.inset"))
                            )
                        ).withFormField(agentCodesForm("self-assessment")))
                  )
                ),
                CheckboxItem(
                    id = Some("corporation-tax-checkbox"),
                    name = Some("corporation-tax-checkbox"),
                    content = Text(msgs("agentCodes.form.corporation-tax.label")),
                    value = "true",
                    checked = ctValue.nonEmpty || agentCodesForm.error("corporation-tax").isDefined,
                    conditionalHtml = Some(
                        govukInput(Input(
                            label = Label(
                                content = Text( msgs("agentCodes.form.corporation-tax.inset"))
                            )
                        ).withFormField(agentCodesForm("corporation-tax")))
                    )
                )
            )
        ))

        @submitButton()
    }
}